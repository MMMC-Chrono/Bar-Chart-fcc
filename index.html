<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bar Chart</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.6.1/d3.min.js" integrity="sha512-MefNfAGJ/pEy89xLOFs3V6pYPs6AmUhXJrRlydI/9wZuGrqxmrdQ80zKHUcyadAcpH67teDZcBeS6oMJLPtTqw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <link rel="stylesheet" href="styles.css">
        
    </head>
    <body>
        <div id="text"></div>
        <script src='https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js'></script>
        <script>

        d3.select('body')
          .append('h1')
          .text('title')
          .attr('id', 'title')
          
        fetch('https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json') 
            .then(response => response.json())
            .then(response => {
                const { data } = response;
                collectedData(data)
            })
    
        function collectedData(data) {
            const w = 700;
            const h = 400;
            const padding = 50;

            const xScale = d3.scaleLinear()
                             .domain([0, data.length - 1])
                             .range([padding, w - padding])
            const yScale = d3.scaleLinear()
                            .domain([0, d3.max(data, (d) => d[1])])
                            .range([h - padding, padding])           
            
            const svg = d3.select("body")
                          .append("svg")
                          .attr("width", w)
                          .attr("height", h);


            svg.selectAll("rect")
               .data(data)
               .enter()
               .append("rect")
               .attr('class', 'bar')
               .attr("x", (d, i) => xScale(i))
               .attr("y", (d) => yScale(d[1]))
               .attr('width', (w / data.length))
               .attr('height', (d) => h - yScale(d[1]) - padding)
               .attr("data-date", (d) => d[0])
               .attr('data-gdp', (d) => d[1])
               .on('mouseover', (d, i) => {                   
                    console.log(i)
                    tooltip.style('opacity', '1')
                           .attr('x', d.x+10)
                           .attr('y', 200)
                    label.text(i)
                         .style('opacity', '1')
                         .attr('x', d.x+12)
                         .attr('y', 220)
            
               })
               .on('mouseout', (d, i) => {
                    tooltip.style('opacity', '0')
                    label.style('opacity', '0')
               })
               
            const tooltip = svg.append('rect')
                               .attr('id', 'tooltip')
                               .attr('width', 100)
                               .attr('height', 50)
                               .style('opacity', '0')
            const label = svg.append('text')
                              .attr('x', 100)
                              .attr('y', 100)
                              .style('opacity', '0')
            
            //Axis
            let dates = data.map((d) => {
                return new Date(d[0])
            })
        
            const xAxisScale = d3.scaleTime()
                                 .domain([d3.min(dates), d3.max(dates)])
                                 .range([padding, w - padding])

            const xAxis = d3.axisBottom(xAxisScale);
            const yAxis = d3.axisLeft(yScale);

            svg.append('g')
               .attr('transform', 'translate(0,' + (h - padding) + ')')
               .attr('id', 'x-axis')
               .call(xAxis)
            svg.append('g')
               .attr('transform', 'translate(' + (padding) + ',0)')
               .attr('id', 'y-axis')
               .call(yAxis)
        } 
    
        </script>
    </body>
</html>